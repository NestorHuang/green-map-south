# 南區綠活圖 - 使用者故事與功能規格

**版本**: 1.0
**最後更新**: 2025年12月2日
**狀態**: 進行中

---

## 目錄

1. [專案概述](#專案概述)
2. [角色定義](#角色定義)
3. [核心功能模組](#核心功能模組)
4. [使用者故事](#使用者故事)
5. [驗收標準](#驗收標準)
6. [非功能需求](#非功能需求)
7. [技術限制與約束](#技術限制與約束)
8. [未來擴展規劃](#未來擴展規劃)

---

## 專案概述

### 專案願景
建立一個由社群驅動、地圖導向的綠色生活資訊共享平台，讓「綠色生活」在台灣南區變得更便利、更可見，並透過「荒野夥伴」的貢獻力量，活化整個永續生活社群。

### 核心目標
1. **快速查找 (Search)**: 使用者能透過地圖和精確的「綠活標籤」，在 30 秒內找到符合需求的店家
2. **簡易貢獻 (Upload)**: 「夥伴」能透過手機，在 1 分鐘內快速上傳新的地點或回報現有資訊
3. **社群活化 (Activate)**: 透過明確的貢獻機制與回報系統，建立一個可自我維護與更新的資料庫

### 價值主張
- **廣度整合**: 整合「食、衣、住、行、育、樂」外加「團體活動場域」，滿足多元需求
- **即時貢獻**: 極簡便的「夥伴上傳」流程，解決現有平台資料老舊的痛點
- **精確標籤**: 提供如「全素 v.s. 提供素食」的精確圖標，解決使用者搜尋時的困擾
- **社群認同**: 特別標識荒野保護協會夥伴，增強組織認同感

---

## 角色定義

### 1. 一般訪客 (Visitor)
**描述**: 對綠色生活感興趣的潛在使用者，無需登入即可瀏覽平台。

**需求場景**:
- 「我現在在高雄火車站附近，哪裡有提供自備杯優惠的咖啡廳？」
- 「我想找一間『全素』餐廳。」
- 「這附近有沒有無包裝商店？」

**權限**: 唯讀 (Read-only)

### 2. 綠活夥伴 (Partner)
**描述**: 熱心的社群貢獻者，是平台活化的關鍵。需要使用 Google 帳號登入。

**需求場景**:
- 「我發現這家麵店內用都不提供免洗餐具，我要把它分享上去！」
- 「這家店倒了，我要回報。」
- 「我想看看我貢獻了哪些地點。」

**權限**: 需登入。可讀取 (Read) 並建立 (Create) 新資料（需經審核）。

#### 特殊類型: 荒野夥伴 (Wilderness Partner)
**描述**: 荒野保護協會的志工或會員，在平台上享有特殊標識。

**額外欄位**:
- 團名/分會（例如：台南分會）
- 自然名（例如：樹蛙）

**顯示方式**: 「台南分會-樹蛙」而非一般的「張三」

### 3. 平台管理員 (Administrator)
**描述**: 平台的核心維護者，確保資料品質與準確性。

**需求場景**:
- 審核新提交的地點
- 處理使用者的錯誤回報
- 管理標籤分類
- 更新或刪除過時的地點資訊

**權限**: 需特殊權限登入。擁有完整的資料庫讀寫權限。

**分為兩個等級**:
- **一般管理員 (Admin)**: 可審核地點、處理回報、管理地點和標籤
- **超級管理員 (Super Admin)**: 擁有所有管理員權限 + 管理員帳號管理

---

## 核心功能模組

### A. 公開功能模組（所有使用者）

#### A-1. 互動式地圖瀏覽
**功能描述**: 使用者可瀏覽一個互動式地圖，地圖上顯示所有已核准的綠色生活地點。

**子功能**:
- GPS 定位優先（首次載入時使用使用者當前位置）
- 地圖縮放、拖曳、平移
- 地點標記（Marker）顯示
- 預設位置：高雄車站（GPS 失敗時）

#### A-2. 地點標記與詳情查看
**功能描述**: 點擊地圖上的標記，底部彈出地點詳情面板。

**顯示內容**:
- 地點名稱
- 地址
- 描述
- 照片輪播（支援多張圖片）
- 綠活標籤
- 登錄者資訊（包含荒野夥伴標識）
- 錯誤回報按鈕（登入使用者可見）

#### A-3. 地址搜尋
**功能描述**: 使用 Google Places Autocomplete 進行地址搜尋。

**特性**:
- 限制搜尋範圍為台灣
- 搜尋類型：營業場所 (establishment)
- 選擇地址後地圖自動移動並放大

#### A-4. 綠活標籤篩選
**功能描述**: 使用者可透過標籤篩選地點。

**預設標籤**:
- 全素/蔬食
- 環保餐具
- 二手/古著
- 在地小農
- 無包裝商店

**篩選行為**:
- 點擊標籤 → 地圖僅顯示包含該標籤的地點
- 再次點擊或點擊「全部」→ 恢復顯示所有地點

---

### B. 登入使用者功能模組（綠活夥伴）

#### B-1. 使用者認證
**功能描述**: 使用 Google OAuth 進行快速登入。

**流程**:
1. 點擊「使用 Google 登入」
2. Google OAuth 彈窗
3. 授權後自動登入
4. 首次登入導向個人資料設定頁

**安全性**:
- Firebase Authentication 管理
- Custom Claims 權限控制
- Session 持久化

#### B-2. 個人資料管理
**功能描述**: 使用者可設定和編輯個人資料。

**欄位**:
- 顯示名稱（必填）
- Email（自動從 Google 帳號取得，不可編輯）
- 是否為荒野夥伴（勾選框）
- 團名/分會（荒野夥伴專用，選填）
- 自然名（荒野夥伴專用，選填）

**驗證**:
- 顯示名稱不可為空
- 荒野夥伴若勾選，建議填寫團名和自然名（但非強制）

#### B-3. 地點登錄
**功能描述**: 夥伴可提交新的綠色生活地點。

**表單欄位**:
- 地點名稱（必填）
- 地址（必填，支援 Google Places Autocomplete）
- 描述（選填，多行文字）
- 綠活標籤（選填，多選）
- 照片上傳（必填，最多 10 張）

**流程**:
1. 填寫表單
2. 前端驗證（必填欄位、照片數量）
3. 地址轉換為經緯度（Google Geocoding API）
4. 照片上傳至 Firebase Storage
5. 寫入 `pending_locations` 集合（待審核）
6. 顯示成功訊息，返回首頁

**資料儲存**:
- 狀態：`pending`
- 包含提交者資訊（UID、Email、顯示名稱、荒野夥伴資訊）
- 提交時間戳記

#### B-4. 錯誤回報
**功能描述**: 夥伴可針對現有地點回報錯誤或過時資訊。

**觸發方式**: 在地點詳情面板點擊「回報此地點資訊有誤」按鈕

**回報欄位**:
- 問題描述（必填，多行文字框）
- 自動記錄：回報者 UID、回報時間、地點 ID

**流程**:
1. 點擊回報按鈕
2. 彈出回報 Modal
3. 填寫問題描述
4. 提交後寫入 `reports` 集合
5. 顯示成功訊息

---

### C. 管理員功能模組

#### C-1. 待審核地點管理
**功能描述**: 管理員可查看、審核待審核的地點提交。

**列表顯示**:
- 地點名稱
- 地址
- 提交者資訊（含荒野夥伴標識）
- 提交時間
- 照片預覽
- 標籤

**操作**:
- **核准**:
  - 使用 Firestore Batch 操作
  - 複製資料到 `locations` 集合
  - 設定狀態為 `approved`
  - 刪除 `pending_locations` 文檔
  - 地點立即出現在公開地圖

- **拒絕**:
  - 刪除 `pending_locations` 文檔
  - 刪除相關照片（Firebase Storage）
  - 可選：記錄拒絕原因（未實作）

**目標**: 48 小時內完成審核

#### C-2. 錯誤回報處理
**功能描述**: 管理員可查看和處理使用者的錯誤回報。

**篩選選項**:
- 待處理（status: 'new'）
- 已解決（status: 'resolved'）

**列表顯示**:
- 地點名稱
- 問題描述
- 回報時間
- 回報者 UID

**操作**:
- **標示為已解決**:
  - 更新 `status` 為 `resolved`
  - 記錄解決時間 `resolvedAt`
  - 從待處理列表移除

**工作流程**:
1. 查看回報詳情
2. 手動修正地點資訊（前往地點管理頁面）
3. 回到回報頁面，標示為已解決

#### C-3. 地點管理（CRUD）
**功能描述**: 管理員可對所有地點進行完整的增刪改查操作。

**列表顯示**:
- 表格形式
- 照片縮略圖
- 地點名稱
- 地址
- 標籤
- 操作按鈕（編輯、刪除）

**新增地點**:
- 彈窗表單
- 欄位同地點登錄
- 管理員創建的地點直接為 `approved` 狀態

**編輯地點**:
- 彈窗表單預填現有資料
- 可修改所有欄位
- 照片管理：
  - 顯示現有照片
  - 可刪除現有照片
  - 可上傳新照片
  - 最終合併為完整照片列表
- 地址變更自動重新地理編碼

**刪除地點**:
- 雙重確認機制
- 自動刪除所有關聯照片（Firebase Storage）
- 從 `locations` 集合永久移除

#### C-4. 標籤管理
**功能描述**: 管理員可管理綠活標籤分類。

**列表顯示**:
- 標籤 ID（技術參考）
- 標籤名稱（顯示名稱）
- 操作按鈕（編輯、刪除）

**新增標籤**:
- 輸入標籤名稱
- 自動生成 ID（Firestore auto-generated）
- 寫入 `tags` 集合

**編輯標籤**:
- 修改標籤名稱
- 所有使用該標籤的地點自動更新顯示

**刪除標籤**:
- 使用情況檢查：
  - 查詢 `locations` 和 `pending_locations` 集合
  - 計算使用該標籤的地點數量
  - 顯示警告訊息
- 雙重確認
- 刪除後地點的標籤陣列仍包含該 ID（但 UI 自動過濾不存在的標籤）

#### C-5. 管理員管理（超級管理員專屬）
**功能描述**: 超級管理員可管理管理員帳號。

**列表顯示**:
- Email
- 角色（admin / superAdmin）
- Firestore 資料與 Custom Claim 同步狀態
- 摺疊式詳細資訊（JSON 格式）
- 操作按鈕（同步權限、移除）

**新增管理員**:
- 輸入 Email
- 選擇角色（預設為 admin）
- 調用 Cloud Function `addAdminByEmail`
- 流程：
  1. 透過 Email 查找使用者 UID
  2. 檢查是否已是管理員
  3. 創建 `admins/{uid}` 文檔
  4. 觸發 `syncAdminStatus` 自動設定 Custom Claims
- 新管理員需登出重新登入生效

**同步權限**:
- 顯示條件：Firestore role 與 Custom Claim 不一致
- 調用 Cloud Function `syncAdminClaim`
- 手動強制同步權限

**移除管理員**:
- 超級管理員顯示「無法移除」
- 一般管理員顯示「移除」按鈕
- 雙重確認
- 刪除 `admins/{uid}` 文檔
- 觸發 `syncAdminStatus` 自動移除 Custom Claims

**權限檢查**:
- 路由守衛：`SuperAdminRoute` 組件
- 檢查 Custom Claim `role === 'superAdmin'`
- 未授權自動重導向首頁

---

## 使用者故事

### Epic 1: 地圖瀏覽與探索

#### Story 1.1: 快速定位當前位置
**身份**: 作為一般訪客
**需求**: 我想要打開網站時自動定位到我的當前位置
**目的**: 讓我能快速找到附近的綠色生活地點

**驗收標準**:
- [ ] 網站載入時自動請求 GPS 權限
- [ ] 允許權限後地圖中心移動到當前位置
- [ ] 拒絕權限時顯示預設位置（高雄車站）
- [ ] GPS 獲取失敗時有友善的錯誤提示

#### Story 1.2: 查看地點詳細資訊
**身份**: 作為一般訪客
**需求**: 我想要點擊地圖上的標記查看地點詳細資訊
**目的**: 了解該地點是否符合我的需求

**驗收標準**:
- [ ] 點擊標記後底部彈出詳情面板
- [ ] 顯示地點名稱、地址、描述
- [ ] 顯示所有上傳的照片（輪播形式）
- [ ] 顯示綠活標籤
- [ ] 顯示登錄者資訊（含荒野夥伴標識）
- [ ] 面板可以透過點擊關閉按鈕或外部區域關閉

#### Story 1.3: 搜尋特定地址
**身份**: 作為一般訪客
**需求**: 我想要搜尋特定地址附近的綠色生活地點
**目的**: 規劃行程時找到目的地附近的綠色選項

**驗收標準**:
- [ ] 頂部有明顯的搜尋框
- [ ] 輸入時自動顯示地址建議（Google Places）
- [ ] 選擇地址後地圖自動移動並放大
- [ ] 搜尋框支援中文地址輸入
- [ ] 搜尋結果限制在台灣範圍

#### Story 1.4: 依標籤篩選地點
**身份**: 作為一般訪客
**需求**: 我想要只顯示特定類型的地點（例如：全素餐廳）
**目的**: 快速找到符合我特定需求的地點

**驗收標準**:
- [ ] 頂部顯示所有可用的綠活標籤
- [ ] 點擊標籤後地圖僅顯示包含該標籤的地點
- [ ] 當前選中的標籤有視覺高亮
- [ ] 可以點擊「全部」或再次點擊標籤來取消篩選
- [ ] 篩選時地點列表即時更新

---

### Epic 2: 使用者認證與個人資料

#### Story 2.1: 使用 Google 帳號快速登入
**身份**: 作為潛在貢獻者
**需求**: 我想要使用 Google 帳號快速登入
**目的**: 避免創建新帳號，快速開始貢獻

**驗收標準**:
- [ ] 頂部顯示「使用 Google 登入」按鈕
- [ ] 點擊後彈出 Google OAuth 視窗
- [ ] 授權後自動登入並關閉彈窗
- [ ] 登入後顯示使用者名稱
- [ ] 首次登入自動導向個人資料設定頁

#### Story 2.2: 設定個人資料
**身份**: 作為登入使用者
**需求**: 我想要設定我的個人資料
**目的**: 讓我的貢獻能正確署名

**驗收標準**:
- [ ] 個人資料頁面包含顯示名稱欄位（必填）
- [ ] Email 欄位顯示但不可編輯（來自 Google）
- [ ] 有「荒野夥伴」勾選框
- [ ] 勾選後顯示「團名/分會」和「自然名」欄位
- [ ] 提交時驗證顯示名稱不為空
- [ ] 成功儲存後顯示確認訊息
- [ ] 資料即時更新到 Firestore

#### Story 2.3: 標識為荒野夥伴
**身份**: 作為荒野保護協會成員
**需求**: 我想要在平台上標識我的荒野夥伴身份
**目的**: 展示我的組織歸屬和自然名

**驗收標準**:
- [ ] 個人資料頁面可勾選「是否為荒野夥伴」
- [ ] 勾選後顯示團名/分會和自然名輸入框
- [ ] 我提交的地點顯示「團名-自然名」而非普通名稱
- [ ] 未勾選時顯示一般的顯示名稱
- [ ] 在地點詳情和待審核列表都能看到荒野夥伴標識

---

### Epic 3: 地點貢獻

#### Story 3.1: 提交新的綠色生活地點
**身份**: 作為登入的綠活夥伴
**需求**: 我想要快速提交一個我發現的綠色生活地點
**目的**: 分享給社群，幫助更多人找到綠色選項

**驗收標準**:
- [ ] 登入後頂部顯示「登錄地點」連結
- [ ] 表單包含地點名稱、地址、描述、標籤、照片欄位
- [ ] 地址欄位支援 Google Places 自動完成
- [ ] 標籤為多選下拉選單
- [ ] 照片上傳支援多選（最多 10 張）
- [ ] 提交前驗證必填欄位
- [ ] 提交後顯示「已提交，等待管理員審核」訊息
- [ ] 自動返回首頁
- [ ] 整個流程可在 1 分鐘內完成（行動裝置）

#### Story 3.2: 上傳地點照片
**身份**: 作為登入的綠活夥伴
**需求**: 我想要上傳多張照片展示地點特色
**目的**: 提供更豐富的視覺資訊幫助其他人判斷

**驗收標準**:
- [ ] 照片上傳欄位支援一次選擇多個檔案
- [ ] 最多可上傳 10 張照片
- [ ] 預覽選中的照片
- [ ] 可以移除已選但尚未上傳的照片
- [ ] 上傳時顯示進度指示
- [ ] 支援常見圖片格式（JPG, PNG, WEBP）
- [ ] 超過 10 張時顯示錯誤訊息

#### Story 3.3: 選擇適當的綠活標籤
**身份**: 作為登入的綠活夥伴
**需求**: 我想要為地點選擇準確的綠活標籤
**目的**: 幫助其他人透過標籤準確找到他們需要的地點

**驗收標準**:
- [ ] 標籤選單顯示所有可用標籤
- [ ] 可以選擇多個標籤
- [ ] 標籤有清楚的名稱說明
- [ ] 已選標籤有視覺指示
- [ ] 可以取消已選標籤
- [ ] 標籤為選填項目（但建議選擇）

---

### Epic 4: 錯誤回報

#### Story 4.1: 回報地點資訊錯誤
**身份**: 作為登入的綠活夥伴
**需求**: 我想要回報某個地點的資訊已經過時或錯誤
**目的**: 幫助維護平台資料的準確性

**驗收標準**:
- [ ] 地點詳情面板顯示「回報此地點資訊有誤」按鈕（僅登入使用者）
- [ ] 點擊後彈出回報 Modal
- [ ] Modal 包含問題描述文字框（必填）
- [ ] 提交後寫入 reports 集合
- [ ] 顯示「已提交回報，感謝您的協助」訊息
- [ ] 自動關閉 Modal
- [ ] 整個流程簡單快速（30 秒內完成）

---

### Epic 5: 管理員審核與管理

#### Story 5.1: 審核待審核地點
**身份**: 作為平台管理員
**需求**: 我想要查看並審核使用者提交的地點
**目的**: 確保平台資料的品質和準確性

**驗收標準**:
- [ ] 管理後台顯示待審核地點列表
- [ ] 列表顯示地點名稱、地址、提交者、提交時間
- [ ] 可以查看所有上傳的照片
- [ ] 顯示提交者是否為荒野夥伴
- [ ] 每個地點有「核准」和「拒絕」按鈕
- [ ] 核准後地點立即出現在公開地圖
- [ ] 拒絕後地點和照片被刪除
- [ ] 操作有雙重確認機制

#### Story 5.2: 在 48 小時內完成審核
**身份**: 作為平台管理員
**需求**: 我想要在 48 小時內完成待審核地點的審核
**目的**: 保持社群的活躍度和貢獻者的熱情

**驗收標準**:
- [ ] 待審核列表依提交時間排序（最舊的在前）
- [ ] 顯示提交已經過的時間
- [ ] 超過 48 小時的項目有視覺提醒（可擴展）
- [ ] 審核流程簡單快速
- [ ] 批次操作功能（未來擴展）

#### Story 5.3: 處理錯誤回報
**身份**: 作為平台管理員
**需求**: 我想要查看並處理使用者的錯誤回報
**目的**: 維護平台資料的即時性和準確性

**驗收標準**:
- [ ] 管理後台顯示錯誤回報列表
- [ ] 可以篩選待處理和已解決的回報
- [ ] 顯示地點名稱、問題描述、回報時間
- [ ] 可以點擊地點名稱快速導航到地點管理
- [ ] 處理完問題後可標示為已解決
- [ ] 已解決的回報移至已解決列表

#### Story 5.4: 編輯現有地點資訊
**身份**: 作為平台管理員
**需求**: 我想要編輯現有地點的資訊
**目的**: 更新過時資訊或修正錯誤

**驗收標準**:
- [ ] 地點管理頁面顯示所有地點列表
- [ ] 每個地點有「編輯」按鈕
- [ ] 點擊後彈出編輯表單，預填現有資料
- [ ] 可以修改所有欄位（名稱、地址、描述、標籤）
- [ ] 可以查看現有照片
- [ ] 可以刪除現有照片
- [ ] 可以上傳新照片
- [ ] 修改地址後自動重新地理編碼
- [ ] 儲存後立即更新地圖顯示

#### Story 5.5: 刪除過時或不適當的地點
**身份**: 作為平台管理員
**需求**: 我想要刪除已歇業或不符合標準的地點
**目的**: 保持平台資料的準確性

**驗收標準**:
- [ ] 每個地點有「刪除」按鈕
- [ ] 點擊後顯示確認對話框
- [ ] 確認後刪除 Firestore 文檔
- [ ] 自動刪除所有關聯照片（Storage）
- [ ] 地點立即從地圖上消失
- [ ] 顯示刪除成功訊息

#### Story 5.6: 管理綠活標籤
**身份**: 作為平台管理員
**需求**: 我想要新增、編輯或刪除綠活標籤
**目的**: 隨著平台發展調整分類系統

**驗收標準**:
- [ ] 標籤管理頁面顯示所有標籤
- [ ] 可以新增新標籤（輸入名稱）
- [ ] 可以編輯標籤名稱
- [ ] 刪除標籤前檢查使用情況
- [ ] 有地點使用時顯示警告並確認
- [ ] 刪除標籤不影響地點資料完整性

---

### Epic 6: 超級管理員功能

#### Story 6.1: 新增管理員帳號
**身份**: 作為超級管理員
**需求**: 我想要將信任的使用者設定為管理員
**目的**: 擴充管理團隊以處理增長的貢獻量

**驗收標準**:
- [ ] 管理員管理頁面顯示新增表單
- [ ] 輸入新管理員的 Email
- [ ] 選擇角色（一般管理員 / 超級管理員）
- [ ] 點擊新增後調用 Cloud Function
- [ ] 成功後顯示確認訊息
- [ ] 新管理員列表即時更新
- [ ] 提示新管理員需登出重新登入

#### Story 6.2: 移除管理員權限
**身份**: 作為超級管理員
**需求**: 我想要移除不再需要管理權限的使用者
**目的**: 維護平台安全性

**驗收標準**:
- [ ] 每個一般管理員顯示「移除」按鈕
- [ ] 超級管理員顯示「無法移除」標籤
- [ ] 點擊移除後顯示確認對話框
- [ ] 確認後刪除 Firestore 文檔
- [ ] 自動觸發 Custom Claims 移除
- [ ] 被移除的管理員刷新後失去權限

#### Story 6.3: 同步管理員權限
**身份**: 作為超級管理員
**需求**: 我想要手動同步管理員的權限設定
**目的**: 解決權限不一致的問題

**驗收標準**:
- [ ] 權限不一致時顯示「同步權限」按鈕
- [ ] 點擊後調用 Cloud Function
- [ ] 成功後顯示確認訊息
- [ ] 權限狀態更新為一致
- [ ] 被同步的使用者需登出重新登入

#### Story 6.4: 查看管理員詳細狀態
**身份**: 作為超級管理員
**需求**: 我想要查看管理員的詳細資訊和權限狀態
**目的**: 診斷權限問題和監控管理員活動

**驗收標準**:
- [ ] 管理員列表顯示基本資訊（Email、角色）
- [ ] 顯示 Firestore 和 Custom Claim 同步狀態
- [ ] 可以展開查看詳細資訊（JSON 格式）
- [ ] 顯示新增時間
- [ ] 顯示最後登入時間（未來擴展）

---

## 驗收標準

### 功能性驗收標準

#### 地圖功能
- [ ] 地圖在 3 秒內完成載入（4G 網路）
- [ ] GPS 定位在 5 秒內完成
- [ ] 地點標記點擊響應時間 < 200ms
- [ ] 支援至少 100 個地點的同時顯示
- [ ] 地址搜尋返回結果 < 1 秒

#### 地點提交
- [ ] 整個提交流程可在 1 分鐘內完成（行動裝置）
- [ ] 照片上傳支援 10 張，每張最大 5MB
- [ ] 表單驗證即時反饋
- [ ] 提交成功率 > 95%

#### 審核流程
- [ ] 管理員可在 48 小時內完成審核
- [ ] 核准操作在 2 秒內完成
- [ ] 核准後地點立即出現在地圖（無需刷新）

#### 錯誤回報
- [ ] 回報提交流程 < 30 秒
- [ ] 回報成功率 > 98%
- [ ] 管理員可在 7 天內處理回報

### 效能驗收標準

#### 載入效能
- [ ] 首次載入時間 < 3 秒（4G 網路）
- [ ] Lighthouse 效能分數 > 90
- [ ] 首次內容繪製 (FCP) < 1.5 秒
- [ ] 最大內容繪製 (LCP) < 2.5 秒

#### 互動效能
- [ ] 按鈕點擊響應時間 < 100ms
- [ ] 地圖操作（縮放、拖曳）流暢 60 FPS
- [ ] 篩選操作結果呈現 < 500ms

#### 資料庫效能
- [ ] Firestore 查詢時間 < 1 秒
- [ ] 並發 100 使用者無效能下降
- [ ] 索引覆蓋所有查詢需求

### 安全性驗收標準

#### 認證與授權
- [ ] 所有敏感操作需要認證
- [ ] 管理功能受 Custom Claims 保護
- [ ] Firestore Security Rules 覆蓋所有集合
- [ ] Storage Rules 保護所有檔案操作

#### 資料保護
- [ ] 無 API 金鑰硬編碼
- [ ] 環境變數妥善管理
- [ ] HTTPS 強制執行
- [ ] CORS 政策正確設定

#### 輸入驗證
- [ ] 前端驗證所有使用者輸入
- [ ] Firestore Rules 驗證寫入資料
- [ ] 防止 XSS 攻擊
- [ ] 防止 SQL Injection（N/A，使用 Firestore）

### 可用性驗收標準

#### 響應式設計
- [ ] 支援螢幕寬度 320px - 2560px
- [ ] 移動裝置 (< 768px) 優先設計
- [ ] 平板裝置 (768px - 1024px) 完整支援
- [ ] 桌面裝置 (> 1024px) 完整支援

#### 瀏覽器相容性
- [ ] Chrome/Edge (最新版本)
- [ ] Firefox (最新版本)
- [ ] Safari (iOS 14+)
- [ ] Samsung Internet (Android)

#### 無障礙性
- [ ] 顏色對比符合 WCAG AA 標準
- [ ] 表單標籤正確關聯
- [ ] 鍵盤導航支援
- [ ] 語義化 HTML 標籤

#### 使用者體驗
- [ ] 所有操作有即時反饋
- [ ] 錯誤訊息清晰易懂
- [ ] 載入狀態明確顯示
- [ ] 成功操作有確認訊息

---

## 非功能需求

### 效能需求

#### 回應時間
- 頁面載入時間：< 3 秒（4G 網路）
- API 回應時間：< 1 秒
- 資料庫查詢時間：< 500ms
- 使用者操作回饋：< 200ms

#### 吞吐量
- 支援 1000 同時上線使用者
- 支援 100 次/秒的 API 請求
- 支援 10 次/秒的地點提交

#### 資源使用
- 前端 Bundle 大小：< 500KB（gzip 後）
- 圖片最佳化：每張 < 500KB
- Firestore 讀取：< 50,000 次/天（免費額度）
- Storage 使用：< 5GB（初期目標）

### 可靠性需求

#### 可用性
- 系統正常運作時間：99.9%（Firebase Hosting SLA）
- 資料備份：Firebase 自動備份
- 災難恢復：< 1 小時（Firebase 自動恢復）

#### 資料完整性
- 零資料遺失
- 交易操作的原子性保證
- 定期資料驗證（未來實作）

#### 錯誤處理
- 所有錯誤有友善的使用者訊息
- 錯誤記錄到 Console（開發環境）
- 關鍵錯誤通知管理員（未來實作）

### 可維護性需求

#### 程式碼品質
- ESLint 無錯誤
- 程式碼註解覆蓋率 > 10%（關鍵邏輯）
- 函數平均長度 < 50 行
- 檔案平均長度 < 500 行

#### 文件完整性
- 所有主要功能有使用者文件
- 所有 API 有開發者文件
- 部署流程有操作手冊
- 架構決策有 ADR（Architecture Decision Records）

#### 測試覆蓋率
- 單元測試覆蓋率 > 70%（未來目標）
- 整合測試覆蓋關鍵流程（未來目標）
- E2E 測試覆蓋主要使用者路徑（未來目標）

### 安全性需求

#### 認證安全
- 使用 OAuth 2.0（Google）
- JWT Token 有效期 < 1 小時
- Session 管理由 Firebase 處理
- 強制 HTTPS

#### 資料安全
- Firestore Security Rules 全面覆蓋
- Storage 檔案存取控制
- 敏感資料加密（Firebase 內建）
- 定期安全審計（未來實作）

#### 應用程式安全
- 輸入驗證（前端 + 後端）
- 輸出編碼防止 XSS
- CORS 政策限制
- Rate Limiting（Firebase 內建）

### 可擴展性需求

#### 水平擴展
- Firebase 自動擴展
- 無伺服器架構
- CDN 分發靜態資源

#### 垂直擴展
- 資料庫索引優化
- 查詢效能優化
- 圖片壓縮和 CDN

#### 功能擴展
- 模組化架構支援新功能
- API 設計考慮向後相容
- 資料模型支援擴展

---

## 技術限制與約束

### 技術棧限制

#### 前端框架
- **限制**: React 19.x
- **原因**: 專案基於 React 建構，遷移成本高
- **影響**: 需遵循 React 生態系統和最佳實踐

#### 後端服務
- **限制**: Firebase (Firestore, Auth, Storage, Functions)
- **原因**: 無伺服器架構選擇
- **影響**: 受 Firebase 功能和定價限制

#### 地圖服務
- **限制**: Google Maps API
- **原因**: 功能完整性和精確度需求
- **影響**: 受 API 配額和費用限制

### 資料庫限制

#### Firestore 限制
- 每個文檔最大 1MB
- 每秒每個文檔最多 1 次寫入
- 查詢限制（無 OR 查詢，有限的複合查詢）
- 索引數量限制

**影響**:
- 圖片不直接存在 Firestore，使用 Storage URL
- 高頻寫入需要資料庫設計優化
- 複雜查詢需要在客戶端實現
- 需要仔細設計索引策略

#### Storage 限制
- 免費配額：5GB
- 單檔案最大 5TB（實際限制在前端控制）
- 下載頻寬限制

**影響**:
- 限制照片上傳數量（每地點最多 10 張）
- 需要圖片壓縮和最佳化
- 考慮使用 CDN（Firebase 內建）

### API 配額限制

#### Google Maps API
- 免費配額：$200/月
- Maps JavaScript API：$7/1000 次載入
- Geocoding API：$5/1000 次請求
- Places API：根據請求類型收費

**影響**:
- 需要 API 金鑰限制（域名白名單）
- 監控 API 使用量
- 實施快取策略
- 考慮替代方案（未來）

#### Firebase 配額
- **Firestore**:
  - 讀取：50,000 次/天（免費）
  - 寫入：20,000 次/天（免費）
  - 刪除：20,000 次/天（免費）

- **Cloud Functions**:
  - 呼叫次數：2,000,000 次/月（免費）
  - 計算時間：400,000 GB-秒/月（免費）

- **Authentication**:
  - 每月活躍使用者無限制（免費層）

**影響**:
- 初期免費額度充足
- 成長後需升級計畫
- 需要優化查詢減少讀取次數

### 瀏覽器與裝置限制

#### 瀏覽器相容性
- **支援**: Chrome, Firefox, Safari, Edge（現代版本）
- **限制**: 不支援 IE11
- **原因**: 使用現代 JavaScript 特性

#### 裝置支援
- **主要**: 行動裝置（iOS, Android）
- **次要**: 桌面裝置
- **限制**: GPS 功能依賴裝置支援

### 地理與語言限制

#### 地理範圍
- **當前**: 台灣南區
- **未來**: 擴展至全台灣
- **限制**: Google Places 資料覆蓋範圍

#### 語言支援
- **當前**: 繁體中文（zh-TW）
- **未來**: 英文支援
- **限制**: UI 文字需人工翻譯

### 安全性約束

#### 認證方式
- **限制**: 僅支援 Google OAuth
- **原因**: 簡化認證流程
- **未來**: 考慮新增其他 OAuth 提供者

#### 資料存取
- **限制**: 所有操作受 Firestore Rules 控制
- **原因**: 安全性第一原則
- **影響**: 複雜查詢需要前端過濾

### 營運約束

#### 維護時間
- **目標**: 無計劃停機時間
- **實際**: 依賴 Firebase SLA (99.95%)
- **更新策略**: 無縫部署（Firebase Hosting）

#### 支援範圍
- **當前**: 社群支援
- **未來**: 考慮客服系統
- **限制**: 志工時間有限

---

## 未來擴展規劃

### 短期擴展（3-6 個月）

#### 使用者功能增強
- [ ] **收藏功能**: 使用者可以收藏喜愛的地點
- [ ] **評分系統**: 使用者可以對地點評分
- [ ] **評論功能**: 使用者可以留下評論
- [ ] **分享功能**: 一鍵分享地點到社交媒體

#### 地圖功能增強
- [ ] **路線規劃**: 整合 Google Directions API
- [ ] **周邊搜索**: 搜尋附近 X 公里內的地點
- [ ] **地點聚合**: 使用 Marker Clustering 處理大量標記
- [ ] **即時位置追蹤**: 使用者移動時地圖自動更新

#### 管理功能增強
- [ ] **批次操作**: 批次審核、批次刪除
- [ ] **數據統計**: 地點數量、提交統計、使用者活躍度
- [ ] **審核歷史**: 記錄審核決策和原因
- [ ] **標籤使用統計**: 顯示每個標籤的使用次數

### 中期擴展（6-12 個月）

#### 社群功能
- [ ] **使用者資料頁**: 查看使用者的貢獻歷史
- [ ] **貢獻排行榜**: 展示活躍貢獻者
- [ ] **徽章系統**: 根據貢獻給予徽章獎勵
- [ ] **地點討論**: 每個地點的討論區

#### 通知系統
- [ ] **Email 通知**: 審核結果、回報處理進度
- [ ] **推播通知**: PWA 推播通知
- [ ] **附近地點提醒**: 基於位置的通知
- [ ] **定期摘要**: 週報、月報

#### 多語言支援
- [ ] **英文界面**: 吸引國際使用者
- [ ] **標籤翻譯**: 標籤多語言支援
- [ ] **描述翻譯**: 地點描述翻譯（機器翻譯 + 人工校對）

#### 進階搜尋
- [ ] **複合條件搜尋**: 多個標籤 AND/OR 查詢
- [ ] **距離篩選**: 搜尋特定距離內的地點
- [ ] **營業時間篩選**: 現在營業中的地點
- [ ] **關鍵字搜尋**: 搜尋地點名稱、描述

### 長期擴展（12+ 個月）

#### 行動應用
- [ ] **React Native App**: 跨平台行動應用
- [ ] **離線功能**: 離線地圖和資料快取
- [ ] **原生推播**: 行動裝置原生推播
- [ ] **相機整合**: 直接拍照上傳

#### AI 功能
- [ ] **圖片自動標註**: 使用 AI 識別照片內容
- [ ] **地點推薦**: 基於使用者行為的個人化推薦
- [ ] **重複地點檢測**: 自動檢測重複提交
- [ ] **內容審核輔助**: AI 輔助管理員審核

#### 開放 API
- [ ] **公開 REST API**: 供第三方應用存取資料
- [ ] **Webhook**: 資料變更通知
- [ ] **批次資料導出**: CSV, JSON 格式
- [ ] **API 文件**: OpenAPI/Swagger 文件

#### 進階分析
- [ ] **使用者行為分析**: Google Analytics 整合
- [ ] **熱力圖**: 地點瀏覽熱度視覺化
- [ ] **趨勢分析**: 綠色生活趨勢追蹤
- [ ] **影響力報告**: 平台對環境的影響評估

### 技術債償還

#### 測試覆蓋
- [ ] **單元測試**: Jest + React Testing Library
- [ ] **整合測試**: 關鍵流程測試
- [ ] **E2E 測試**: Cypress 或 Playwright
- [ ] **效能測試**: Lighthouse CI

#### 效能優化
- [ ] **程式碼分割**: React.lazy + Suspense
- [ ] **圖片最佳化**: 縮略圖、WebP 格式
- [ ] **狀態管理優化**: 考慮 Zustand 或 Redux Toolkit
- [ ] **快取策略**: Service Worker、React Query

#### 架構改進
- [ ] **TypeScript 遷移**: 提升類型安全
- [ ] **API 層抽象**: 統一資料存取層
- [ ] **錯誤邊界**: 更好的錯誤處理
- [ ] **監控系統**: Sentry 或類似服務

---

## 附錄

### A. 綠活標籤定義

#### 當前標籤
1. **全素/蔬食** (`vegan`)
   - 定義：完全不使用動物性食材的餐廳或店家
   - 範例：素食餐廳、蔬食小吃

2. **環保餐具** (`eco-friendly-utensils`)
   - 定義：提供環保餐具或鼓勵自備餐具的店家
   - 範例：提供竹製餐具、自備容器折扣

3. **二手/古著** (`second-hand`)
   - 定義：販售二手商品或古著的店家
   - 範例：二手市集、古著店、舊貨店

4. **在地小農** (`local-farmer`)
   - 定義：販售在地農產品的店家或市集
   - 範例：農夫市集、在地小農合作社

5. **無包裝商店** (`package-free`)
   - 定義：提供無包裝商品或鼓勵零廢棄的店家
   - 範例：裸賣店、零廢棄商店

#### 未來標籤建議
- 有機商店
- 環保清潔用品
- 綠能產品
- 公平貿易
- 環保住宿
- 生態旅遊
- 環保交通
- 綠色教育

### B. 資料模型快速參考

#### locations 集合
```javascript
{
  name: string,              // 地點名稱
  address: string,           // 地址
  description: string,       // 描述（選填）
  position: GeoPoint,        // 經緯度
  photoURLs: string[],       // 照片 URL 陣列
  tags: string[],            // 標籤 ID 陣列
  status: 'approved',        // 狀態
  submitterInfo: {           // 提交者資訊
    displayName: string,
    isWildernessPartner: boolean,
    groupName: string,
    naturalName: string
  },
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

#### users 集合
```javascript
{
  uid: string,
  email: string,
  displayName: string,
  isWildernessPartner: boolean,
  groupName: string,         // 荒野夥伴專用
  naturalName: string,       // 荒野夥伴專用
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

#### reports 集合
```javascript
{
  locationId: string,
  locationName: string,
  reportText: string,
  reportedBy: string,        // UID
  reportedAt: Timestamp,
  status: 'new' | 'resolved',
  resolvedAt: Timestamp      // 選填
}
```

### C. 權限矩陣

| 操作 | 訪客 | 夥伴 | 管理員 | 超級管理員 |
|-----|------|------|--------|-----------|
| 瀏覽地圖 | ✅ | ✅ | ✅ | ✅ |
| 查看地點詳情 | ✅ | ✅ | ✅ | ✅ |
| 登錄新地點 | ❌ | ✅ | ✅ | ✅ |
| 回報錯誤 | ❌ | ✅ | ✅ | ✅ |
| 審核地點 | ❌ | ❌ | ✅ | ✅ |
| 管理地點（編輯/刪除） | ❌ | ❌ | ✅ | ✅ |
| 管理標籤 | ❌ | ❌ | ✅ | ✅ |
| 處理回報 | ❌ | ❌ | ✅ | ✅ |
| 管理管理員 | ❌ | ❌ | ❌ | ✅ |

### D. 關鍵指標 (KPI)

#### 使用者指標
- 每月活躍使用者 (MAU)
- 每日活躍使用者 (DAU)
- 新使用者註冊數
- 使用者留存率（7 天、30 天）

#### 貢獻指標
- 每月新增地點數
- 活躍貢獻者數量
- 平均每位貢獻者提交數
- 錯誤回報數量

#### 品質指標
- 地點審核平均時間
- 地點資訊準確率
- 錯誤回報處理平均時間
- 使用者滿意度

#### 技術指標
- 頁面載入時間
- API 回應時間
- 系統正常運作時間
- 錯誤率

---

## 文件版本歷史

| 版本 | 日期 | 作者 | 變更內容 |
|------|------|------|---------|
| 1.0 | 2025-12-02 | 開發團隊 | 初始版本 |

---

**文件結束**
