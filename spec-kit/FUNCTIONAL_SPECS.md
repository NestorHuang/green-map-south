# 功能規格書 (Functional Specs)

本文件詳述系統 A, B, C 三大模組的具體功能規格。

## 模組 A: 地圖與搜尋 (Map & Search)
此為使用者查找資訊的核心介面。

| ID   | 功能規格描述 (依據 Q&A 決議) |
| :--- | :--- |
| **F-A1** | **互動地圖初始化**<br> **平台類型**: PWA (Web App)。<br> **地圖邏輯**: 必須採用 **GPS 優先** 邏輯。<br> 1. (優先) 請求 `navigator.geolocation` 取得使用者 GPS。<br> 2. (備案) 若失敗，嘗試讀取瀏覽器儲存的「最後已知位置」。<br> 3. (預設) 若以上皆無，預設中心點為「高雄市火車站」。<br> 4. **縮放尺度**: 初始地圖縮放等級應顯示中心點半徑約 500 公尺的範圍。 |
| **F-A2** | *(待補充)* |
| **F-A3** | **地點詳情互動介面**<br> **模式**: 必須採用「**資訊面板模式 (Bottom Sheet)**」。<br> 1. 使用者點擊地圖上的圖釘 (Pin)。<br> 2. **禁止**彈出傳統小資訊卡或跳轉頁面。<br> 3. 應由螢幕下方滑出「資訊面板」，直接顯示 F-A3 的完整詳情。 |
| **F-A4** | **關鍵字搜尋**<br>1. 在 Header UI 中提供一個文字輸入框。<br>2. 使用者輸入文字時，動態篩選地圖上的地點。<br>3. 查詢邏輯應為前綴匹配 (prefix search)。 |
| **F-A5** | **分類與標籤篩選**<br>1. 在 Header UI 中提供一組標籤按鈕。<br>2. 點擊標籤按鈕後，地圖應只顯示包含該標籤的地點。<br>3. 需提供「清除篩選」的選項。 |
| **F-A-RWD** | **響應式介面 (RWD)**<br>應用程式的所有核心介面均已進行響應式設計優化。<br>1. **Header**: 在手機版視圖下，導覽選項（如登入、上傳）會收合在一個漢堡選單中，確保搜尋和篩選功能的可見性。<br>2. **管理後台**: 在手機版視圖下，側邊導覽列會預設隱藏，並可透過漢堡選單按鈕喚出，以適應較小的螢幕寬度。 |

## 模組 B: 伙伴貢獻 (Partner Contribution)
此為「綠活伙伴」貢獻資料的核心功能。

| ID   | 功能規格描述 |
| :--- | :--- |
| **F-B1** | **快速上傳**<br>1. 提供一個 `/upload` 頁面，僅限登入使用者存取。<br>2. 表單應包含：名稱、地址、描述、照片、標籤。<br>3. 系統需將地址轉換為地理座標。**此功能依賴外部服務 [OpenStreetMap Nominatim API](https://nominatim.org/)**。<br>4. 提交的資料應進入 `pending_locations` 集合等待審核。 |
| **F-B1 Auth** | **社交帳號登入**<br>1. 提供 Google 帳號快速登入選項。<br>2. 登入後，UI 應顯示使用者資訊與登出選項。 |
| **F-B1 Photos**| **照片上傳**<br>1. 上傳表單中需包含圖片上傳功能。<br>2. 圖片應上傳至 Firebase Storage，並將 URL 存入對應的文件中。 |
| **F-B3** | **回報錯誤**<br>1. 在地點詳情面板 (F-A3) 中，為登入使用者提供「回報錯誤」按鈕。<br>2. 點擊後彈出一個表單，讓使用者填寫問題描述。<br>3. 提交的回報應存入 `reports` 集合。 |

## 模組 C: 管理員功能 (Admin)
此為「平台管理員」維護資料品質的後台功能。

| ID   | 功能規格描述 |
| :--- | :--- |
| **F-C1** | **審核待處理地點**<br>1. 提供一個 `/admin/pending` 頁面，顯示 `pending_locations` 集合中的所有文件。<br>2. 提供「核准」與「拒絕」按鈕。<br>3. **核准**: 將文件複製到 `locations` 集合，並從 `pending_locations` 刪除。<br>4. **拒絕**: 從 `pending_locations` 刪除文件，並刪除 Storage 中的對應圖片。 |
| **F-C2** | **管理回報與資料**<br>1. 提供一個 `/admin/reports` 頁面，顯示 `reports` 集合中的文件。<br>2. 提供「標示為已解決」功能，更新文件狀態。<br>3. (未來) 提供管理現有地點與標籤的介面。 |
| **F-C3** | **管理標籤**<br> (未來) 提供新增、修改、刪除「綠活標籤」的介面。 |
| **F-C4** | **管理員權限指派**<br>管理員的指派是透過直接操作 Firestore 資料庫來完成的。<br>1. **操作方式**: 在 Firebase 控制台中，手動於 `admins` 集合底下新增一個文件。<br>2. **文件 ID**: 該文件的 ID **必須**是目標使用者的 Firebase UID。<br>3. **自動同步**: 一旦文件被建立或刪除，後端的雲端函式會自動將該使用者的管理員權限（Custom Claim）進行同步。 |
